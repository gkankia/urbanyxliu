mapboxgl.accessToken="pk.eyJ1Ijoiam9yam9uZTkwIiwiYSI6ImNrZ3R6M2FvdTBwbmwycXBibGRqM2w2enYifQ.BxjvFSGqefuC9yFCrXC-nQ";var marker,map=new mapboxgl.Map({container:"map",style:"mapbox://styles/jorjone90/cltetry3r00r301nw54sh4jal",center:[15.650354,58.396637],zoom:12,attributionControl:!1});function generateIsochrone(e){var m=document.querySelector('input[name="profile"]:checked').value,d=document.getElementById("contours_minutes").value,e="https://api.mapbox.com/isochrone/v1/mapbox/"+m+"/"+e.lng+","+e.lat+"?contours_minutes="+d+"&polygons=true&denoise=0.1&generalize=10&access_token="+mapboxgl.accessToken;fetch(e).then(function(e){return e.json()}).then(function(s){map.getSource("isochrone").setData(s),map.getSource("isochrone").setData(s);var e=turf.bbox(s);map.fitBounds(e,{bearing:-35,pitch:52,padding:{top:50,right:50,bottom:50,left:50}});var t,l={"pois-eatout":" üçî Eating Out","pois-health":" ‚öïÔ∏è Healthcare","pois-financial":" üí∞ Banking"},u=document.getElementById("data_source").value;"pois-eatout"===u?t="https://raw.githubusercontent.com/gkankia/urbanyxliu/main/data%20collection/osm/pois-eatout.geojson":"pois-health"===u?t="https://raw.githubusercontent.com/gkankia/urbanyxliu/main/data%20collection/osm/pois-health.geojson":"pois-financial"===u&&(t="https://raw.githubusercontent.com/gkankia/urbanyxliu/main/data%20collection/osm/pois-banking.geojson"),t&&fetch(t).then(function(e){return e.json()}).then(function(e){var t={type:"FeatureCollection",features:e.features.filter(function(e){return turf.booleanPointInPolygon(turf.point(e.geometry.coordinates),s.features[0])})};map.getSource("featuresWithinIsochrone").setData(t);var n={};t.features.forEach(function(e){e=e.properties.amenity;n[e]||(n[e]=0),n[e]++});e=t.features.length,t=l[u];document.getElementById("legend-title").innerHTML="<p>There are a total of <strong> <span class='innerhtml' style='color: yellow; background-color: black'>"+e+"</strong></span>"+(t||u.toUpperCase())+" locations within <strong> <span class='innerhtml' style='color: yellow; background-color: black'>"+d+" minutes "+m+"</span></strong> distance</p>";var a=document.getElementById("legend");a.innerHTML="";var o,r,c,i={bar:"#c51b7d",cafe:"#fdbf6f",restaurant:"#80cdc1",clinic:"#a6cee3",dentist:"#cab2d6",hospital:"#fb9a99",pharmacy:"#fdbf6f",veterinary:"#b2df8a",atm:"#ffff99",payment_terminal:"#ff7f00",bank:"#33a02c"};for(o in n)n.hasOwnProperty(o)&&((r=document.createElement("span")).className="legend-circle",r.style.backgroundColor=i[o]||"#000",(c=document.createElement("p")).innerHTML=r.outerHTML+"<strong>"+o.replace("_"," ")+":</strong> "+n[o],a.appendChild(c));a.style.display="block"}).catch(function(e){console.log("Error fetching data from selected data source:",e)})}).catch(function(e){console.log("Error fetching isochrone data:",e)})}map.addControl(new mapboxgl.ScaleControl),map.on("click",function(e){e=e.lngLat;marker&&marker.remove(),marker=new mapboxgl.Marker({color:"#fb8072"}).setLngLat(e).addTo(map),generateIsochrone(e)}),map.on("load",function(){map.addSource("isochrone",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),map.addLayer({id:"isochrone-layer",type:"fill",source:"isochrone",layout:{},paint:{"fill-color":"#f768a1","fill-opacity":.5}}),map.addSource("featuresWithinIsochrone",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),map.addLayer({id:"featuresWithinIsochrone-layer",type:"circle",source:"featuresWithinIsochrone",paint:{"circle-radius":3,"circle-opacity":1,"circle-color":["match",["get","amenity"],"bar","#c51b7d","cafe","#fdbf6f","restaurant","#80cdc1","clinic","#a6cee3","dentist","#cab2d6","hospital","#fb9a99","pharmacy","#fdbf6f","veterinary","#b2df8a","atm","#ffff99","payment_terminal","#ff7f00","bank","#33a02c","#000000"]}})}),document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll('input[name="profile"]').forEach(function(e){e.addEventListener("change",function(){var e=marker?marker.getLngLat():map.getCenter();document.querySelectorAll(".toggle").forEach(function(e){e.classList.remove("selected")}),this.nextElementSibling.classList.add("selected"),generateIsochrone(e)})}),document.getElementById("contours_minutes").addEventListener("change",function(){generateIsochrone(marker?marker.getLngLat():map.getCenter())}),document.getElementById("data_source").addEventListener("change",function(){generateIsochrone(marker?marker.getLngLat():map.getCenter())})}),document.addEventListener("contextmenu",function(e){e.preventDefault()});